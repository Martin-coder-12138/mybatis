<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itheima.mapper.SysUserMapper">

    <resultMap id="userMap" type="SysUser">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Jul 29 17:12:30 CST 2019.
        -->
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="user_name" jdbcType="VARCHAR" property="userName" />
        <result column="user_password" jdbcType="VARCHAR" property="userPassword" />
        <result column="user_email" jdbcType="VARCHAR" property="userEmail" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="user_info" jdbcType="LONGVARCHAR" property="userInfo" />
        <result column="head_img" jdbcType="LONGVARBINARY" property="headImg" />
    </resultMap>


    <insert id="insert">
        INSERT into mybatis.sys_user (id, user_name, user_password, user_email, user_info, head_img, create_time)
        VALUES (#{id}, #{userName}, #{userPassword}, #{userEmail}, #{userInfo}, #{headImg,jdbcType=BLOB},
                #{createTime,jdbcType=TIMESTAMP});
    </insert>
    <insert id="insert2" useGeneratedKeys="true" keyProperty="id">
        INSERT into mybatis.sys_user (id, user_name, user_password, user_email, user_info, head_img, create_time)
        VALUES (#{id}, #{userName}, #{userPassword}, #{userEmail}, #{userInfo}, #{headImg,jdbcType=BLOB},
                #{createTime,jdbcType=TIMESTAMP});
    </insert>
    <insert id="insertList">
        INSERT INTO mybatis.sys_user (user_name, user_password, user_email, user_info, head_img, create_time)
        VALUES
        <foreach collection="list" item="user" separator="," index="i">
            (#{user.userName},#{user.userPassword},#{user.userEmail},#{user.userInfo},#{user.headImg,jdbcType=BLOB},#{user.createTime,jdbcType=TIMESTAMP})
        </foreach>
    </insert>


    <update id="updateByIdSelective">
        UPDATE mybatis.sys_user
        <set>
            <if test="userName != null and userName.trim() != ''">
                user_name = #{userName},
            </if>
            <if test="userPassword != null and userPassword.trim() != ''">
                user_password = #{userPassword},
            </if>
            <if test="userEmail != null and userEmail.trim() != ''">
                user_email = #{userEmail},
            </if>
            <if test="userInfo != null and userInfo.trim() != ''">
                user_info = #{userInfo},
            </if>
            <if test="headImg != null">
                head_img = #{headImg,jdbcType=BLOB},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        Where id = #{id};
    </update>


    <delete id="delete">
        DELETE
        FROM mybatis.sys_user
        WHERE id = #{id};
    </delete>


    <select id="selectById" resultType="SysUser">
        SELECT id, user_name, user_password, user_email, user_info, head_img, create_time
        FROM mybatis.sys_user
        WHERE id = #{id};

    </select>
    <select id="selectAll" resultType="com.itheima.pojo.SysUser">
        SELECT id, user_name, user_password, user_email, user_info, head_img, create_time
        FROM mybatis.sys_user;

    </select>
    <select id="selectByUser" resultType="com.itheima.pojo.SysUser">
        SELECT id, user_name, user_password, user_email, user_info, head_img, create_time
        FROM mybatis.sys_user
        <where>
            <if test="userName != null and userName.trim() != ''">
                and user_name LIKE CONCAT('%',#{userName},'%');
            </if>
            <if test="userEmail != null and userEmail.trim() != ''">
                and user_email = #{userEmial}
            </if>
        </where>
    </select>


    <select id="selectByidOrUserName" resultType="com.itheima.pojo.SysUser">
        SELECT id, user_name, user_password, user_email, user_info, head_img, create_time
        FROM mybatis.sys_user
        WHERE 1 = 1
        <choose>
            <when test="id != null">
                and id = #{id}
            </when>
            <when test="userName != null and userName.trim() != ''">
                and user_name = #{userName}
            </when>
            <otherwise>
                and 1=2;
            </otherwise>
        </choose>

    </select>


    <select id="selectByidList" resultType="com.itheima.pojo.SysUser">
        SELECT id, user_name, user_password, user_email, user_info, head_img, create_time
        FROM mybatis.sys_user
        WHERE id IN
        <foreach collection="id" open="(" close=")" separator="," item="id" index="i">
            #{id}
        </foreach>
    </select>
<!--    <select id="selectUserAndRoleByid" resultType="com.itheima.pojo.SysUser">
        SELECT u.id,
               u.user_name,
               u.user_password,
               u.user_email,
               u.user_info,
               u.head_img,
               u.create_time,
               r.id          "role.id",
               r.role_name   "role.rolename",
               r.enabled     "role.enabled",
               r.create_by   "role.createBy",
               r.create_time "role.createTime"
        FROM mybatis.sys_user u
                 INNER JOIN mybatis.sys_user_role ur ON u.id = ur.user_id
                 INNER JOIN mybatis.sys_role r ON ur.role_id = r.id
        WHERE u.id = #{id};


    </select>-->

    <select id="selectAllUserAndRoles" resultMap="userRoleListMap">
        SELECT u.id,
               u.user_name,
               u.user_password,
               u.user_email,
               u.user_info,
               u.head_img,
               u.create_time,
               r.id          role_id,
               r.role_name   role_role_name,
               r.enabled     role_enable,
               r.create_by   role_create_by,
               r.create_time role_create_time
        FROM mybatis.sys_user u
                 INNER JOIN mybatis.sys_user_role ur ON u.id = ur.user_id
                 INNER JOIN mybatis.sys_role r ON ur.role_id = r.id


    </select>

    <resultMap id="userRoleListMap" type="SysUser" extends="userMap">
        <collection property="roleList" columnPrefix="role_" resultMap="com.itheima.mapper.SysRoleMapper.roleMap"/>
    </resultMap>
</mapper>